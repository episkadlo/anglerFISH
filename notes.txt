#install java:
sudo apt install openjdk-11-jre-headless

#install nextflow
curl -s https://get.nextflow.io | bash

#copy the tutorial.nf workflow from nextflow tutorial and try running it to see it nextflow works
./nextflow run tutorial.nf


# install docker
curl -fsSL https://get.docker.com -o get-docker.sh
sudo sh get-docker.sh

#to run docker as no-root user:
sudo usermod -aG docker <user-name, here ewa>

#check version and if installed
docker --version
# output: Docker version 19.03.13, build 4484c46d9d



## there was a problem with installing python 2.7 and python-pip.
## what helped was changing DNS server setting. What solvedthe probelm was:
sudo vim /etc/default/docker
## and uncommenting the line saying
DOCKER_OPTS="--DNS 8.8.8.8 --DNS 8.8.4.4
## then restarting docker/terminal


### pull a container with hisat2 (biocontainers)
docker pull quay.io/biocontainers/hisat2:2.2.0--py36hf0b53f7_4

#confirm it work by going into interactive mode and running hisat2 --help
sudo docker run -it quay.io/biocontainers/hisat2:2.2.0--py36hf0b53f7_4


## use the automatically generated $projectDir to make the pipeline portable

## run the nextflow with testdocker3 - works with files

## download the chr10 from mm10 from http://hgdownload.soe.ucsc.edu/goldenPath/mm10/chromosomes/

## unzip by
gunzip <file>.fa.gz

## create hisat2 index
hisat2-build <path to unzipped .fa with genome > index_name


## pull jellyfish docker for kmer processing
docker pull biocontainers/jellyfish:v2.2.10-2-deb_cv1


## jellyfish docker I just pulled did not have the ps, which what necessary for nextflow integration;
## for that reason I made anew docker image basing on the biocontainers/jellyfish:v2.2.10-2-deb_cv1 with installed procps
## root user was necessary, as well as adding the user permissions to the nextflow config file to deal with permissions


## updating the createGenomicIndexes.nf to aslo create the jellyfish indexes for desired kmerFilterScript

## need to add python 2.7 and possibly other dependencies to the jellyfish container in order to operate the kmer_filer python script, so jellyfish container needs to be rebuilt
docker build -t jellyfish_ps:1.1 .

## need to add also the biopython to have numpy installed; modified the dockerfile for jellyfish and built again
docker build -t jellyfish_ps:1.2
##now the kmer filter works well
